<?xml version="1.0"?>
<robot name="tracked_vehicle">

  <!-- Materials -->
  <material name="black">
    <color rgba="0.0 0.0 0.0 1.0"/>
  </material>
  <material name="dark_grey">
    <color rgba="0.3 0.3 0.3 1.0"/>
  </material>
  <material name="light_grey">
    <color rgba="0.7 0.7 0.7 1.0"/>
  </material>
  <material name="red">
    <color rgba="0.8 0.0 0.0 1.0"/>
  </material>
  <material name="track_material">
    <color rgba="0.2 0.2 0.2 1.0"/>
  </material>
  <material name="flipper_material">
    <color rgba="0.3 0.3 0.3 1.0"/>
  </material>

  <!-- Base Link -->
  <link name="base_link">
    <visual>
      <origin xyz="0 0 0.05" rpy="0 0 0"/>
      <geometry>
        <box size="0.2 0.2 0.1"/>
      </geometry>
      <material name="dark_grey"/>
    </visual>
    <collision>
      <origin xyz="0 0 0.05" rpy="0 0 0"/>
      <geometry>
        <box size="0.2 0.2 0.1"/>
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 0.05" rpy="0 0 0"/>
      <mass value="5.0"/>
      <inertia ixx="0.0208333" ixy="0" ixz="0" iyy="0.0208333" iyz="0" izz="0.0333333"/>
    </inertial>
  </link>

  <!-- Chassis Link (Main Body) - Original dimensions -->
  <joint name="chassis_joint" type="fixed">
    <parent link="base_link"/>
    <child link="chassis"/>
    <origin xyz="0 0 0.345"/>
  </joint>

  <link name="chassis">
    <visual>
      <origin xyz="0 0 0"/>
      <geometry>
        <box size="1.285 0.355 0.345"/>
      </geometry>
      <material name="dark_grey"/>
    </visual>
    <collision>
      <origin xyz="0 0 0"/>
      <geometry>
        <box size="1.285 0.355 0.345"/>
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="65.0"/>
      <inertia ixx="1.636" ixy="0" ixz="0" iyy="9.638" iyz="0" izz="9.679"/>
    </inertial>
  </link>

  <!-- Left Track - Scaled to original dimensions -->
  <joint name="left_track_joint" type="revolute">
    <parent link="base_link"/>
    <child link="left_track"/>
    <origin xyz="0 0.26 0.12074999999999998"/>
    <axis xyz="0 1 0"/>
    <limit lower="0" upper="0" effort="1000" velocity="0"/>
  </joint>

  <link name="left_track">
    <inertial>
      <origin xyz="0 0 0.0141" rpy="0 0 0"/>
      <mass value="3.0"/>
      <inertia ixx="0.002731" ixy="0" ixz="0" iyy="0.032554" iyz="1.5e-05" izz="0.031391"/>
    </inertial>
    
    <!-- Main track body - scaled to original dimensions -->
    <visual name="left_track_body">
      <origin xyz="0 0 0.01855" rpy="1.5708 0 1.5708"/>
      <geometry>
        <box size="0.165 0.18094 1.1565"/>
      </geometry>
      <material name="track_material"/>
    </visual>
    <collision name="left_track_body">
      <origin xyz="0 0 0.01855" rpy="1.5708 0 1.5708"/>
      <geometry>
        <box size="0.165 0.18094 1.1565"/>
      </geometry>
    </collision>

    <!-- Front cylinder -->
    <visual name="left_track_front">
      <origin xyz="0.578 0 0.01855" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.165" radius="0.09047"/>
      </geometry>
      <material name="track_material"/>
    </visual>
    <collision name="left_track_front">
      <origin xyz="0.578 0 0.01855" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.165" radius="0.09047"/>
      </geometry>
    </collision>

    <!-- Rear cylinder -->
    <visual name="left_track_rear">
      <origin xyz="-0.578 0 0.01855" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.165" radius="0.09047"/>
      </geometry>
      <material name="track_material"/>
    </visual>
    <collision name="left_track_rear">
      <origin xyz="-0.578 0 0.01855" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.165" radius="0.09047"/>
      </geometry>
    </collision>
  </link>

  <!-- Right Track - Scaled to original dimensions -->
  <joint name="right_track_joint" type="revolute">
    <parent link="base_link"/>
    <child link="right_track"/>
    <origin xyz="0 -0.26 0.12074999999999998"/>
    <axis xyz="0 1 0"/>
    <limit lower="0" upper="0" effort="1000" velocity="0"/>
  </joint>

  <link name="right_track">
    <inertial>
      <origin xyz="0 0 0.0141" rpy="0 0 0"/>
      <mass value="3.0"/>
      <inertia ixx="0.002731" ixy="0" ixz="0" iyy="0.032554" iyz="1.5e-05" izz="0.031391"/>
    </inertial>
    
    <!-- Main track body - scaled to original dimensions -->
    <visual name="right_track_body">
      <origin xyz="0 0 0.01855" rpy="1.5708 0 1.5708"/>
      <geometry>
        <box size="0.165 0.18094 1.1565"/>
      </geometry>
      <material name="track_material"/>
    </visual>
    <collision name="right_track_body">
      <origin xyz="0 0 0.01855" rpy="1.5708 0 1.5708"/>
      <geometry>
        <box size="0.165 0.18094 1.1565"/>
      </geometry>
    </collision>

    <!-- Front cylinder -->
    <visual name="right_track_front">
      <origin xyz="0.578 0 0.01855" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.165" radius="0.09047"/>
      </geometry>
      <material name="track_material"/>
    </visual>
    <collision name="right_track_front">
      <origin xyz="0.578 0 0.01855" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.165" radius="0.09047"/>
      </geometry>
    </collision>

    <!-- Rear cylinder -->
    <visual name="right_track_rear">
      <origin xyz="-0.578 0 0.01855" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.165" radius="0.09047"/>
      </geometry>
      <material name="track_material"/>
    </visual>
    <collision name="right_track_rear">
      <origin xyz="-0.578 0 0.01855" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.165" radius="0.09047"/>
      </geometry>
    </collision>
  </link>

  <!-- Front Left Flipper - Scaled and positioned for original dimensions -->
  <joint name="front_left_flipper_joint" type="revolute">
    <parent link="base_link"/>
    <child link="front_left_flipper"/>
    <origin xyz="0.5 0.35 0.12" rpy="0 -0.5 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.57" upper="1.57" effort="100" velocity="1.0"/>
    <dynamics damping="0.1" friction="0.1"/>
  </joint>

  <link name="front_left_flipper">
    <inertial>
      <origin xyz="0.08 0 0" rpy="0 0 0"/>
      <mass value="5.0"/>
      <inertia ixx="0.0017491" ixy="2.8512e-07" ixz="0.0018277" iyy="0.012277" iyz="-3.6288e-07" izz="0.010941"/>
    </inertial>
    
    <!-- Large wheel -->
    <visual name="front_left_flipper_wheel">
      <origin xyz="0 0 0" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.14" radius="0.12"/>
      </geometry>
      <material name="flipper_material"/>
    </visual>
    <collision name="front_left_flipper_wheel">
      <origin xyz="0 0 0" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.14" radius="0.12"/>
      </geometry>
    </collision>

    <!-- Small wheel -->
    <visual name="front_left_flipper_small_wheel">
      <origin xyz="0.33 0 0" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.14" radius="0.06"/>
      </geometry>
      <material name="flipper_material"/>
    </visual>
    <collision name="front_left_flipper_small_wheel">
      <origin xyz="0.33 0 0" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.14" radius="0.06"/>
      </geometry>
    </collision>

    <!-- Track bars -->
    <visual name="front_left_flipper_top_bar">
      <origin xyz="0.165 0 0.0325" rpy="0 0.184162 0"/>
      <geometry>
        <box size="0.33 0.14 0.055"/>
      </geometry>
      <material name="flipper_material"/>
    </visual>
    <collision name="front_left_flipper_top_bar">
      <origin xyz="0.165 0 0.0325" rpy="0 0.184162 0"/>
      <geometry>
        <box size="0.33 0.14 0.055"/>
      </geometry>
    </collision>

    <visual name="front_left_flipper_bottom_bar">
      <origin xyz="0.165 0 -0.0325" rpy="0 -0.184162 0"/>
      <geometry>
        <box size="0.33 0.14 0.055"/>
      </geometry>
      <material name="flipper_material"/>
    </visual>
    <collision name="front_left_flipper_bottom_bar">
      <origin xyz="0.165 0 -0.0325" rpy="0 -0.184162 0"/>
      <geometry>
        <box size="0.33 0.14 0.055"/>
      </geometry>
    </collision>
  </link>

  <!-- Rear Left Flipper -->
  <joint name="rear_left_flipper_joint" type="revolute">
    <parent link="base_link"/>
    <child link="rear_left_flipper"/>
    <origin xyz="-0.5 0.35 0.12" rpy="3.14159 -0.5 3.14159"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.57" upper="1.57" effort="100" velocity="1.0"/>
    <dynamics damping="0.1" friction="0.1"/>
  </joint>

  <link name="rear_left_flipper">
    <inertial>
      <origin xyz="0.08 0 0" rpy="0 0 0"/>
      <mass value="5.0"/>
      <inertia ixx="0.0017491" ixy="2.8512e-07" ixz="0.0018277" iyy="0.012277" iyz="-3.6288e-07" izz="0.010941"/>
    </inertial>
    
    <visual name="rear_left_flipper_wheel">
      <origin xyz="0 0 0" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.14" radius="0.12"/>
      </geometry>
      <material name="flipper_material"/>
    </visual>
    <collision name="rear_left_flipper_wheel">
      <origin xyz="0 0 0" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.14" radius="0.12"/>
      </geometry>
    </collision>

    <visual name="rear_left_flipper_small_wheel">
      <origin xyz="0.33 0 0" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.14" radius="0.06"/>
      </geometry>
      <material name="flipper_material"/>
    </visual>
    <collision name="rear_left_flipper_small_wheel">
      <origin xyz="0.33 0 0" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.14" radius="0.06"/>
      </geometry>
    </collision>

    <visual name="rear_left_flipper_top_bar">
      <origin xyz="0.165 0 0.0325" rpy="0 0.184162 0"/>
      <geometry>
        <box size="0.33 0.14 0.055"/>
      </geometry>
      <material name="flipper_material"/>
    </visual>
    <collision name="rear_left_flipper_top_bar">
      <origin xyz="0.165 0 0.0325" rpy="0 0.184162 0"/>
      <geometry>
        <box size="0.33 0.14 0.055"/>
      </geometry>
    </collision>

    <visual name="rear_left_flipper_bottom_bar">
      <origin xyz="0.165 0 -0.0325" rpy="0 -0.184162 0"/>
      <geometry>
        <box size="0.33 0.14 0.055"/>
      </geometry>
      <material name="flipper_material"/>
    </visual>
    <collision name="rear_left_flipper_bottom_bar">
      <origin xyz="0.165 0 -0.0325" rpy="0 -0.184162 0"/>
      <geometry>
        <box size="0.33 0.14 0.055"/>
      </geometry>
    </collision>
  </link>

  <!-- Front Right Flipper -->
  <joint name="front_right_flipper_joint" type="revolute">
    <parent link="base_link"/>
    <child link="front_right_flipper"/>
    <origin xyz="0.5 -0.35 0.12" rpy="3.14159 0.5 3.14159"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.57" upper="1.57" effort="100" velocity="1.0"/>
    <dynamics damping="0.1" friction="0.1"/>
  </joint>

  <link name="front_right_flipper">
    <inertial>
      <origin xyz="-0.08 0 0" rpy="0 0 0"/>
      <mass value="5.0"/>
      <inertia ixx="0.0017491" ixy="2.8512e-07" ixz="0.0018277" iyy="0.012277" iyz="-3.6288e-07" izz="0.010941"/>
    </inertial>
    
    <visual name="front_right_flipper_wheel">
      <origin xyz="0 0 0" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.14" radius="0.12"/>
      </geometry>
      <material name="flipper_material"/>
    </visual>
    <collision name="front_right_flipper_wheel">
      <origin xyz="0 0 0" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.14" radius="0.12"/>
      </geometry>
    </collision>

    <visual name="front_right_flipper_small_wheel">
      <origin xyz="-0.33 0 0" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.14" radius="0.06"/>
      </geometry>
      <material name="flipper_material"/>
    </visual>
    <collision name="front_right_flipper_small_wheel">
      <origin xyz="-0.33 0 0" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.14" radius="0.06"/>
      </geometry>
    </collision>

    <visual name="front_right_flipper_top_bar">
      <origin xyz="-0.165 0 0.0325" rpy="0 0.184162 3.14159"/>
      <geometry>
        <box size="0.33 0.14 0.055"/>
      </geometry>
      <material name="flipper_material"/>
    </visual>
    <collision name="front_right_flipper_top_bar">
      <origin xyz="-0.165 0 0.0325" rpy="0 0.184162 3.14159"/>
      <geometry>
        <box size="0.33 0.14 0.055"/>
      </geometry>
    </collision>

    <visual name="front_right_flipper_bottom_bar">
      <origin xyz="-0.165 0 -0.0325" rpy="0 -0.184162 3.14159"/>
      <geometry>
        <box size="0.33 0.14 0.055"/>
      </geometry>
      <material name="flipper_material"/>
    </visual>
    <collision name="front_right_flipper_bottom_bar">
      <origin xyz="-0.165 0 -0.0325" rpy="0 -0.184162 3.14159"/>
      <geometry>
        <box size="0.33 0.14 0.055"/>
      </geometry>
    </collision>
  </link>

  <!-- Rear Right Flipper -->
  <joint name="rear_right_flipper_joint" type="revolute">
    <parent link="base_link"/>
    <child link="rear_right_flipper"/>
    <origin xyz="-0.5 -0.35 0.12" rpy="0 0.5 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-1.57" upper="1.57" effort="100" velocity="1.0"/>
    <dynamics damping="0.1" friction="0.1"/>
  </joint>

  <link name="rear_right_flipper">
    <inertial>
      <origin xyz="-0.08 0 0" rpy="0 0 0"/>
      <mass value="5.0"/>
      <inertia ixx="0.0017491" ixy="2.8512e-07" ixz="0.0018277" iyy="0.012277" iyz="-3.6288e-07" izz="0.010941"/>
    </inertial>
    
    <visual name="rear_right_flipper_wheel">
      <origin xyz="0 0 0" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.14" radius="0.12"/>
      </geometry>
      <material name="flipper_material"/>
    </visual>
    <collision name="rear_right_flipper_wheel">
      <origin xyz="0 0 0" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.14" radius="0.12"/>
      </geometry>
    </collision>

    <visual name="rear_right_flipper_small_wheel">
      <origin xyz="-0.33 0 0" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.14" radius="0.06"/>
      </geometry>
      <material name="flipper_material"/>
    </visual>
    <collision name="rear_right_flipper_small_wheel">
      <origin xyz="-0.33 0 0" rpy="1.5708 0 0"/>
      <geometry>
        <cylinder length="0.14" radius="0.06"/>
      </geometry>
    </collision>

    <visual name="rear_right_flipper_top_bar">
      <origin xyz="-0.165 0 0.0325" rpy="0 0.184162 3.14159"/>
      <geometry>
        <box size="0.33 0.14 0.055"/>
      </geometry>
      <material name="flipper_material"/>
    </visual>
    <collision name="rear_right_flipper_top_bar">
      <origin xyz="-0.165 0 0.0325" rpy="0 0.184162 3.14159"/>
      <geometry>
        <box size="0.33 0.14 0.055"/>
      </geometry>
    </collision>

    <visual name="rear_right_flipper_bottom_bar">
      <origin xyz="-0.165 0 -0.0325" rpy="0 -0.184162 3.14159"/>
      <geometry>
        <box size="0.33 0.14 0.055"/>
      </geometry>
      <material name="flipper_material"/>
    </visual>
    <collision name="rear_right_flipper_bottom_bar">
      <origin xyz="-0.165 0 -0.0325" rpy="0 -0.184162 3.14159"/>
      <geometry>
        <box size="0.33 0.14 0.055"/>
      </geometry>
    </collision>
  </link>

  <!-- Velodyne Lidar -->
  <joint name="velodyne_joint" type="fixed">
    <parent link="chassis"/>
    <child link="velodyne"/>
    <origin xyz="0.4283333333333333 0 0.1925"/>
  </joint>

  <link name="velodyne">
    <visual>
      <geometry>
        <cylinder length="0.05" radius="0.05"/>
      </geometry>
      <material name="red"/>
    </visual>
    <collision>
      <origin xyz="0.015 0 -0.0065"/>
      <geometry>
        <cylinder length="0.0315" radius="0.055"/>
      </geometry>
    </collision>
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="5.0"/>
      <inertia ixx="0.00354167" ixy="0" ixz="0" iyy="0.00354167" iyz="0" izz="0.00625"/>
    </inertial>
  </link>

  <!-- IMU -->
  <joint name="imu_joint" type="fixed">
    <parent link="chassis"/>
    <child link="imu_link"/>
    <origin xyz="0.4283333333333333 0 0.1925"/>
  </joint>

  <link name="imu_link">
    <inertial>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <mass value="0.01"/>
      <inertia ixx="1e-06" ixy="0" ixz="0" iyy="1e-06" iyz="0" izz="1e-06"/>
    </inertial>
  </link>

  <!-- Gazebo Materials and Friction -->
  <gazebo reference="chassis">
    <mu1>2.0</mu1>
    <mu2>2.0</mu2>
    <self_collide>false</self_collide>
  </gazebo>

  <gazebo reference="left_track">
    <mu1>0.7</mu1>
    <mu2>150</mu2>
    <fdir1>0 1 0</fdir1>
    <self_collide>false</self_collide>
  </gazebo>

  <gazebo reference="right_track">
    <mu1>0.7</mu1>
    <mu2>150</mu2>
    <fdir1>0 1 0</fdir1>
    <self_collide>false</self_collide>
  </gazebo>

  <gazebo reference="front_left_flipper">
    <material>Gazebo/DarkGrey</material>
    <mu1>0.7</mu1>
    <mu2>150</mu2>
    <fdir1>0 1 0</fdir1>
    <self_collide>true</self_collide>
    <max_contacts>20</max_contacts>
  </gazebo>

  <gazebo reference="rear_left_flipper">
    <material>Gazebo/DarkGrey</material>
    <mu1>0.7</mu1>
    <mu2>150</mu2>
    <fdir1>0 1 0</fdir1>
    <self_collide>true</self_collide>
    <max_contacts>20</max_contacts>
  </gazebo>

  <gazebo reference="front_right_flipper">
    <material>Gazebo/DarkGrey</material>
    <mu1>0.7</mu1>
    <mu2>150</mu2>
    <fdir1>0 1 0</fdir1>
    <self_collide>true</self_collide>
    <max_contacts>20</max_contacts>
  </gazebo>

  <gazebo reference="rear_right_flipper">
    <material>Gazebo/DarkGrey</material>
    <mu1>0.7</mu1>
    <mu2>150</mu2>
    <fdir1>0 1 0</fdir1>
    <self_collide>true</self_collide>
    <max_contacts>20</max_contacts>
  </gazebo>

  <!-- Prevent fixed joint lumping for chassis -->
  <gazebo reference="chassis_joint">
    <preserveFixedJoint>true</preserveFixedJoint>
  </gazebo>

  <!-- IMU Sensor -->
  <gazebo reference="imu_link">
    <sensor name="tb3_imu" type="imu">
      <always_on>true</always_on>
      <update_rate>200</update_rate>
      <imu>
        <angular_velocity>
          <x>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>2e-4</stddev>
            </noise>
          </x>
          <y>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>2e-4</stddev>
            </noise>
          </y>
          <z>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>2e-4</stddev>
            </noise>
          </z>
        </angular_velocity>
        <linear_acceleration>
          <x>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>1.7e-2</stddev>
            </noise>
          </x>
          <y>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>1.7e-2</stddev>
            </noise>
          </y>
          <z>
            <noise type="gaussian">
              <mean>0.0</mean>
              <stddev>1.7e-2</stddev>
            </noise>
          </z>
        </linear_acceleration>
      </imu>
    </sensor>
  </gazebo>

  <!-- Velodyne Lidar -->
  <gazebo reference="velodyne">
    <sensor name="velodyne" type="gpu_lidar">
      <update_rate>10</update_rate>
      <visualize>true</visualize>
      <always_on>true</always_on>
      <gz_frame_id>velodyne</gz_frame_id>
      <topic>velodyne</topic>
      <lidar>
        <scan>
          <horizontal>
            <samples>512</samples>
            <resolution>1</resolution>
            <min_angle>-3.14159265359</min_angle>
            <max_angle>3.14159265359</max_angle>
          </horizontal>
          <vertical>
            <samples>32</samples>
            <resolution>1</resolution>
            <min_angle>-0.55</min_angle>
            <max_angle>0.26</max_angle>
          </vertical>
        </scan>
        <range>
          <min>0.2</min>
          <max>131.0</max>
          <resolution>0.01</resolution>
        </range>
      </lidar>
    </sensor>
  </gazebo>

  <!-- Tracked Vehicle Plugin -->
  <gazebo>
    <plugin name="gz::sim::systems::TrackedVehicle" filename="gz-sim-tracked-vehicle-system">
      <left_track><link>left_track</link></left_track>
      <left_track><link>front_left_flipper</link></left_track>
      <left_track><link>rear_left_flipper</link></left_track>
      <right_track><link>right_track</link></right_track>
      <right_track><link>front_right_flipper</link></right_track>
      <right_track><link>rear_right_flipper</link></right_track>
      <tracks_separation>0.4</tracks_separation>
      <tracks_height>0.18094</tracks_height>
      <steering_efficiency>0.5</steering_efficiency>
      <topic>/cmd_vel</topic>
      <odom_topic>/odom</odom_topic>
      <tf_topic>/tf</tf_topic>
      <frame_id>odom</frame_id>
      <child_frame_id>base_link</child_frame_id>
      <!-- <debug>1</debug> -->
    </plugin>
  </gazebo>

  <!-- Track Controllers -->
  <gazebo>
    <plugin name='gz::sim::systems::TrackController' filename='gz-sim-track-controller-system'>
      <link>left_track</link>
      <min_velocity>-1.0</min_velocity>
      <max_velocity>1.0</max_velocity>
      <debug>1</debug>
    </plugin>
  </gazebo>

  <gazebo>
    <plugin name='gz::sim::systems::TrackController' filename='gz-sim-track-controller-system'>
      <link>right_track</link>
      <min_velocity>-1.0</min_velocity>
      <max_velocity>1.0</max_velocity>
      <debug>1</debug>
    </plugin>
  </gazebo>

  <!-- Track Controllers for Flippers -->
  <gazebo>
    <plugin name='gz::sim::systems::TrackController' filename='gz-sim-track-controller-system'>
      <link>front_left_flipper</link>
      <min_velocity>-1.0</min_velocity>
      <max_velocity>1.0</max_velocity>
    </plugin>
  </gazebo>

  <gazebo>
    <plugin name='gz::sim::systems::TrackController' filename='gz-sim-track-controller-system'>
      <link>rear_left_flipper</link>
      <min_velocity>-1.0</min_velocity>
      <max_velocity>1.0</max_velocity>
    </plugin>
  </gazebo>

  <gazebo>
    <plugin name='gz::sim::systems::TrackController' filename='gz-sim-track-controller-system'>
      <link>front_right_flipper</link>
      <min_velocity>-1.0</min_velocity>
      <max_velocity>1.0</max_velocity>
    </plugin>
  </gazebo>

  <gazebo>
    <plugin name='gz::sim::systems::TrackController' filename='gz-sim-track-controller-system'>
      <link>rear_right_flipper</link>
      <min_velocity>-1.0</min_velocity>
      <max_velocity>1.0</max_velocity>
    </plugin>
  </gazebo>

  <!-- Joint State Publisher -->
  <gazebo>
    <plugin filename="gz-sim-joint-state-publisher-system" name="gz::sim::systems::JointStatePublisher">
      <topic>joint_states</topic>
      <update_rate>30</update_rate>
      <joint_name>front_left_flipper_joint</joint_name>
      <joint_name>rear_left_flipper_joint</joint_name>
      <joint_name>front_right_flipper_joint</joint_name>
      <joint_name>rear_right_flipper_joint</joint_name>
      <joint_name>left_track_joint</joint_name>
      <joint_name>right_track_joint</joint_name>
    </plugin>
  </gazebo>

</robot>